{% extends "base.html" %}

{% block content %}
<div class="container mt-5" id="profile">
    <h2>User Profile</h2>

    <!-- Profile Information -->
    <div class="form-group">
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="id_username">Username:</label>
                <input type="text" id="id_username" name="username" value="{{ username }}" class="form-control" readonly>
            </div>
            <div class="form-group">
                <label for="id_email">Email address:</label>
                <input type="email" id="id_email" name="email" value="{{ email }}" class="form-control" readonly>
            </div>
            <div class="form-group">
                <label for="id_phone_number">Phone number:</label>
                <input type="text" id="id_phone_number" name="phone_number" value="{{ phone_number }}" class="form-control" readonly>
            </div>
            <button type="submit" class="btn btn-success btn-sm mt-2">Save changes</button>
        </form>
    </div>

    <!-- Actions -->
    <div class="mt-3">
        <a href="#create-event-section" class="btn btn-success btn-block" style="max-width: 300px;" onclick="toggleSection('create-event-section')">Create Event</a>
        <a href="#my-events-section" class="btn btn-success btn-block mt-2" style="max-width: 300px;" onclick="toggleSection('my-events-section')">My Events</a>
        <a href="#purchased-tickets-section" class="btn btn-success btn-block mt-2" style="max-width: 300px;" onclick="toggleSection('purchased-tickets-section')">Purchased Tickets</a>
        <form action="{% url 'password_reset' %}" method="post" class="mt-2" style="max-width: 300px;">
            {% csrf_token %}
            <button type="submit" class="btn btn-success btn-block">Reset Password</button>
        </form>
    </div>

    <!-- Create Event Section -->
    <div id="create-event-section" style="display: none; margin-top: 30px;">
        <h3>Create Event</h3>
        <form method="post" action="{% url 'event_create' %}">
            {% csrf_token %}
            {{ event_form.as_p }}  <!-- Render the EventForm here -->
            <button type="submit" class="btn btn-success">Create Event</button>
        </form>
    </div>

    <!-- My Events Section -->
    <div id="my-events-section" style="display: none; margin-top: 30px;">
        <h3>My Events</h3>
        {% if my_events.exists %}
        <ul class="list-group">
            {% for event in my_events %}
            <li class="list-group-item">{{ event.name }} - {{ event.date }}</li>
            {% endfor %}
        </ul>
        {% else %}
        <p>You haven't created any events yet.</p>
        {% endif %}
    </div>

    <!-- Purchased Tickets Section -->
    <div id="purchased-tickets-section" style="display: none; margin-top: 30px;">
        <h3>Purchased Tickets</h3>
        {% if purchased_tickets.exists %}
        <ul class="list-group">
            {% for ticket in purchased_tickets %}
            <li class="list-group-item">
                <strong>Event:</strong> {{ ticket.event.name }}<br>
                <strong>Date:</strong> {{ ticket.event.date }}<br>
                <strong>Quantity:</strong> {{ ticket.quantity }}<br>
                <strong>Purchased on:</strong> {{ ticket.purchase_date|date:"M. d, Y, P" }}
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>You haven't purchased any tickets yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function toggleSection(sectionId) {
        var section = document.getElementById(sectionId);
        if (section.style.display === "none") {
            section.style.display = "block";
            section.scrollIntoView({ behavior: 'smooth' });
        } else {
            section.style.display = "none";
        }
    }
</script>
{% endblock %}
